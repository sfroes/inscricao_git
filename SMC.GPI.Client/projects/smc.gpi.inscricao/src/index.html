<!doctype html>
<html lang="pt-br">
  <head>
    <title>GPI.Inscrição</title>
    <base href="/Dev/GPI.Inscricao/App/" />
    <link rel="icon" href="~/Content/Images/favicon.ico" />
    <meta charset="utf-8" />
    <meta http-equiv="content-language" content="pt-br" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="accept-language" content="pt-br" />
    <meta name="author" content="GTI - Gerência de Tecnologia da Informação" />
    <meta name="copyright" content="© 2023 GTI" />
    <meta
      name="description"
      content="Sistema de Gestão de Inscrições - PUC Minas"
    />
    <meta
      name="keywords"
      content="Sistema de Gestão de Inscrições - PUC Minas"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="manifest" href="/manifest.json"> -->
    <link id="cssProcesso" href="@urlCSS" rel="stylesheet" />
    <!-- FA 6 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/solid.min.css"
      integrity="sha512-pZlKGs7nEqF4zoG0egeK167l6yovsuL8ap30d07kA5AJUq+WysFlQ02DLXAmN3n0+H3JVz5ni8SJZnrOaYXWBA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- FONT HEEBO -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Heebo:wght@300&display=swap"
      rel="stylesheet"
    />
    <!--Script para buscar o css do processo amarzenado em uma seção e adicionar a
    as tags manager que foram cadastradas no processo-->
    <script type="text/javascript">
      //Carregara as funcionalidades após o carregamento do DOM
      document.addEventListener("DOMContentLoaded", () => {
        //Rodar somente depois que os elemento forem inseridos na tela
        function runWhenElementInserted(selector, callback) {
          // Se o elemento já existe no DOM, executa a callback imediatamente
          const existingElement = document.querySelector(selector);
          if (existingElement) {
            callback(existingElement);
            return;
          }

          // Caso contrário, observa a inserção no DOM
          const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
              mutation.addedNodes.forEach((node) => {
                if (node.matches && node.matches(selector)) {
                  callback(node);
                  observer.disconnect(); // Para evitar múltiplas execuções
                }
              });
            });
          });

          if (document.body) {
            observer.observe(document.body, { childList: true, subtree: true });
          } else {
            console.error(
              "Body não encontrado! Verifique se o script está sendo carregado corretamente.",
            );
          }
        }

        runWhenElementInserted("#cssProcesso", () => {
          // Recupera o CSS do processo na sessionStorage
          const cssProcesso = sessionStorage.getItem("cssProcesso");
          if (cssProcesso) {
            document
              .getElementById("cssProcesso")
              .setAttribute("href", cssProcesso);
          }

          // Buscar IDs do Google Tag Manager armazenados na sessionStorage
          const idTagManager = sessionStorage.getItem("tagManager");
          if (idTagManager) {
            idTagManager.split(",").forEach((tag) => {
              inserirGTMHead(tag.trim());
              inserirGTMBody(tag.trim());
            });
          }
        });

        function inserirGTMHead(gtmId) {
          const script = document.createElement("script");
          script.type = "text/javascript";
          script.async = true;
          script.innerHTML = `
            (function(w, d, s, l, i){
              w[l] = w[l] || [];
              w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
              var f = d.getElementsByTagName(s)[0],
                  j = d.createElement(s),
                  dl = l !== 'dataLayer' ? '&l=' + l : '';
              j.async = true;
              j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
              f.parentNode.insertBefore(j, f);
            })(window, document, 'script', 'dataLayer', '${gtmId}');
          `;
          document.head.appendChild(script);
        }

        function inserirGTMBody(gtmId) {
          const noscript = document.createElement("noscript");
          noscript.innerHTML = `
            <iframe src="https://www.googletagmanager.com/ns.html?id=${gtmId}"
              height="0" width="0" style="display: none; visibility: hidden"></iframe>
          `;
          document.body.insertBefore(noscript, document.body.firstChild);
        }
      });
    </script>
  </head>

  <body>
    <app-root></app-root>
  </body>
</html>
