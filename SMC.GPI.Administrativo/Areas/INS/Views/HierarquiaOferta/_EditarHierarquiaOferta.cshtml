@model HierarquiaOfertaViewModel

@using (Smc.Form("formCadastroItemHierarquiaOferta").ConfirmUnloadWithoutSaveChanges().Begin())
{
    using (Smc.Div("fieldsetCadastroItemHierarquiaOferta").Begin())
    {
        if (Model.RaizPermiteItemFilho && Model.RaizPermiteOferta)
        {
            @(Smc.ButtonSet()
                .AddButton(Smc.Button("ContextoNovaItemHierarquia")
                .CssClass("smc-btn-novo-icotext-destaque")
                .Attribute("data-context", "contextoNovaRaiz"))
            )
            @(Smc.ContextMenu("contextoNovaRaiz").OpenEvent(SMCMouseEvent.LeftClick)
                .Item(itemMenu => itemMenu.Text(Smc.GetUIResource("Botao_Novo_Oferta_Raiz_Hierarquia_Oferta"))
                                .Tooltip(Smc.GetUIResource("Botao_Novo_Oferta_Raiz_Hierarquia_Oferta_Tooltip"))
                                .Attribute(SMCMvcConsts.MODAL_ID, "modalCadastroOferta")
                                .Attribute(SMCMvcConsts.DATA_BEHAVIOR, SMCMvcConsts.MODAL_BEHAVIOR_OPEN)
                                .Attribute(SMCMvcConsts.MODAL_TITLE, Smc.GetUIResource("Cadastrar_Oferta_Hierarquia_Oferta_Modal_Titulo"))
                                .Ajax(isPost: false, updateTargetId: "#divHierarquiaOferta")
                                .SecurityToken(UC_INS_001_01_05.MANTER_OFERTA)
                                .Url(Html.SMCAction("CadastrarOfertaHierarquiaOferta", "HierarquiaOferta",
                                                        new
                                                        {                                                                                                                        
                                                            seqProcesso = SMCDESCrypto.EncryptNumberForURL(Model.SeqProcesso)
                                                        }
                                                  )
                                ))
                 .Item(itemMenu => itemMenu.Text(Smc.GetUIResource("Botao_Novo_Item_Raiz_Hierarquia_Oferta"))
                            .Tooltip(Smc.GetUIResource("Botao_Novo_Item_Raiz_Hierarquia_Oferta_Tooltip"))
                            .Attribute(SMCMvcConsts.MODAL_ID, "modalAssociarItemHierarquiaOferta")
                            .Attribute(SMCMvcConsts.DATA_BEHAVIOR, SMCMvcConsts.MODAL_BEHAVIOR_OPEN)
                            .Attribute(SMCMvcConsts.MODAL_TITLE, Smc.GetUIResource("Associar_Item_Hierarquia_Oferta_Modal_Titulo"))
                            .Ajax(isPost: false, updateTargetId: "#divHierarquiaOferta")
                            .SecurityToken(UC_INS_001_01_04.ASSOCIAR_ITEM_HIERARQUIA_OFERTA)
                            .Url(Html.SMCAction("IncluirItemHierarquiaOferta", "HierarquiaOferta",
                                                    new
                                                    {                                                        
                                                        seqProcesso = SMCDESCrypto.EncryptNumberForURL(Model.SeqProcesso)
                                                    }
                                               )
                            ))
            )
        }
        else if (Model.RaizPermiteOferta)
        {
            @(Smc.ButtonSet()
                .AddButton(Smc.Button(SMCMvcConsts.MODAL_BEHAVIOR_OPEN)
                    .Attribute(SMCMvcConsts.MODAL_ID, "modalCadastroOferta")
                    .Text(Smc.GetUIResource("Botao_Novo_Oferta_Raiz_Hierarquia_Oferta"))
                        .Attribute(SMCMvcConsts.MODAL_TITLE, Smc.GetUIResource("Cadastrar_Oferta_Hierarquia_Oferta_Modal_Titulo"))
                    .Tooltip(Smc.GetUIResource("Botao_Novo_Oferta_Raiz_Hierarquia_Oferta_Tooltip"))
                    .Ajax(isPost: false, updateTargetId: "#divHierarquiaOferta")
                    .CssClass("smc-btn-novo-icotext-destaque")
                    .SecurityToken(UC_INS_001_01_04.ASSOCIAR_ITEM_HIERARQUIA_OFERTA)
                    .Url(Html.SMCAction("CadastrarOfertaHierarquiaOferta", "HierarquiaOferta",
                           new
                           {
                               seqProcesso = SMCDESCrypto.EncryptNumberForURL(Model.SeqProcesso)
                           }
                    )))
            )
        }
        else
        {
            @(Smc.ButtonSet()
                .AddButton(Smc.Button(SMCMvcConsts.MODAL_BEHAVIOR_OPEN)
                    .Attribute(SMCMvcConsts.MODAL_ID, "modalAssociarItemHierarquiaOferta")
                    .Attribute(SMCMvcConsts.MODAL_TITLE, Smc.GetUIResource("Cadastro_Item_Hierarquia_Oferta_Modal_Titulo"))
                    .Text(Smc.GetUIResource("Botao_Novo_Item_Raiz_Hierarquia_Oferta"))
                    .Tooltip(Smc.GetUIResource("Botao_Novo_Item_Raiz_Hierarquia_Oferta_Tooltip"))
                    .Ajax(isPost: false, updateTargetId: "#divHierarquiaOferta")
                    .CssClass("smc-btn-novo-icotext-destaque")
                    .SecurityToken(UC_INS_001_01_04.ASSOCIAR_ITEM_HIERARQUIA_OFERTA)
                    .Url(Url.Action("AssociarItemHierarquiaOferta", "HierarquiaOferta", new { @seqProcesso = SMCDESCrypto.EncryptNumberForURL(Model.SeqProcesso) })))
            )
        }
        <div id="divHierarquiaOferta">
            @Html.Action("ArvoreHierarquiaOferta", Model)
        </div>
    }

    @(Smc.ButtonSet()
        .AddButton(Smc.Button("Voltar", "Index", "Processo")
            .Type(SMCButtonType.Link)
            .CssClass("smc-btn-voltar-icotext"))
    )
}


@using (Smc.ModalWindow("modalAssociarItemHierarquiaOferta")        
        .Title(Smc.GetUIResource("Cadastro_Item_Hierarquia_Oferta_Modal_Titulo"))
        .Form("AssociarItemHierarquiaOferta", "SalvarAssociacaoItemHierarquiaOferta", "HierarquiaOferta", null, true, x => x.Ajax("#divHierarquiaOferta", fieldsContainerToRequest: "#divHierarquiaOferta"))
        .Button(SMCButtonBehavior.Salvar, config: bnt => bnt.DisplayMode(SMCButtonDisplayMode.TextAndIcon).Highlight())
        .Button(SMCButtonBehavior.Fechar, config: bnt => bnt.DisplayMode(SMCButtonDisplayMode.TextAndIcon))
        .Begin())
{ }

@using (Smc.ModalWindow("modalCadastroOferta").Size(SMCModalWindowSize.Largest).CssClass("smc-modal-largest-expandida")
        .Form("CadastrarOfertaHierarquiaOferta", "SalvarOfertaHierarquiaOferta", "HierarquiaOferta", null, true, x => x.Ajax("#divHierarquiaOferta", fieldsContainerToRequest: "#divHierarquiaOferta"))
        .Button(SMCButtonBehavior.Salvar, config: bnt => bnt.DisplayMode(SMCButtonDisplayMode.TextAndIcon).Highlight())
        .Button(SMCButtonBehavior.Fechar, config: bnt => bnt.DisplayMode(SMCButtonDisplayMode.TextAndIcon))
        .Begin())
{ }
